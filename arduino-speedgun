#include <Wire.h> 
#include <LiquidCrystal_I2C.h>
// 헤더파일 추가해야함
int sensorPin1 = 9;    // 센서 1 핀 번호
int sensorPin2 = 10;   // 센서 2 핀 번호
int RazerSensor = 8;
int val1;
int val2;
int speed = 0;
const int distance_cm = 5;
LiquidCrystal_I2C lcd(0x27, 16, 2);

unsigned long startTime1 = 0;  // 센서 1의 시작 시간
unsigned long startTime2 = 0;  // 센서 2의 시작 시간
unsigned long timeDiff = 0;    // 시간 차이

void setup() {
  Serial.begin(9600);
  pinMode(sensorPin1, INPUT);
  pinMode(sensorPin2, INPUT);
  pinMode(RazerSensor, OUTPUT);
  lcd.begin();
}

void loop() {
  val1 = digitalRead(sensorPin1);
  val2 = digitalRead(sensorPin2);
  //digitalWrite(RazerSensor,HIGH);
  if (val1 == LOW && startTime1 == 0) {
    startTime1 = micros();
  }
  if (val2 == LOW && startTime2 == 0){
    startTime2 = micros();
  }
  
  if (startTime2 != 0 && startTime1 != 0) {
    timeDiff = startTime2 - startTime1;
    timeDiff = abs(timeDiff);
    Serial.print("Time Difference: ");
    if(timeDiff > 400000000 ){
      timeDiff = 4294967294 - timeDiff;
      speed = (distance_cm / 100000.0) / (timeDiff / 3600000.0);
      Serial.print(speed);
      lcd.print("SPEED :  ");
      lcd.print(speed);
      lcd.print("km/h");
    }
    else{
      speed = (distance_cm / 100000.0) / (timeDiff / 3600000.0);
      Serial.print(speed);
      lcd.print("SPEED :  ");
      lcd.print(speed);
      lcd.print("km/h");
    }
    Serial.println(" seconds");
    // 변수 초기화
    startTime1 = 0;
    startTime2 = 0;
    delay(1000);
    lcd.clear();
  }
}
